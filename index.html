<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Geo Nuclear Quick Pick 3.3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body {
  font-family: system-ui;
  background: #0f1220;
  color: #00ff9d;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
  text-align: center;
}
input, button {
  padding: 10px;
  margin: 8px;
  font-size: 16px;
}
#pick {
  font-size: 36px;
  font-weight: bold;
  margin-top: 30px;
}
#badge {
  position: absolute;
  top: 20px;
  right: 20px;
  background: #111a33cc;
  padding: 10px 15px;
  border-radius: 12px;
  font-size: 14px;
  color: #ffffff;
  text-align: right;
  max-width: 300px;
}
</style>
</head>
<body>

<h2>ðŸ’¥ Geo Nuclear Quick Pick 3.3 ðŸ’¥</h2>
<input type="file" id="imgInput" accept="image/*">
<button onclick="runOCR()">RuleazÄƒ analizÄƒ</button>

<div id="pick">Rezultatul va apÄƒrea aici...</div>
<div id="badge"></div>

<script>
// Liste echipe pe liga (extensibil)
const leagues = {
  "Premier League": ["Arsenal","Aston Villa","Bournemouth","Brentford","Brighton","Chelsea","Crystal Palace","Everton","Fulham","Liverpool","Man City","Man United","Newcastle","Nottingham","Tottenham","West Ham","Wolves","Leicester","Sheffield","Burnley"]
};

// Monte Carlo
function poissonRandom(lambda){let L=Math.exp(-lambda),p=1,k=0;while(p>L){k++;p*=Math.random();}return k-1;}
function monteCarlo(xgH,xgA,sims=100000){
  let cH=0, cX=0, cA=0;
  for(let i=0;i<sims;i++){
    let h=poissonRandom(xgH), a=poissonRandom(xgA);
    if(h>a)cH++; else if(h==a)cX++; else cA++;
  }
  return {pH:cH/sims, pX:cX/sims, pA:cA/sims};
}

// Detectare liga
function detectLeague(text){
  for(let league in leagues){
    for(let team of leagues[league]){
      if(text.toLowerCase().includes(team.toLowerCase())) return league;
    }
  }
  return null;
}

// OCR
function runOCR(){
  let file=document.getElementById("imgInput").files[0];
  if(!file){alert("Alege poza"); return;}
  document.getElementById("pick").innerHTML = "Se proceseazÄƒ OCR...";
  document.getElementById("badge").innerHTML = "";
  Tesseract.recognize(file,'eng',{logger:m=>console.log(m)})
    .then(({data:{text}})=>{processText(text);});
}

// Parse avansat + detect xG + cote
function processText(text){
  // curatare text
  text = text.replace(/\r/g,' ').replace(/\n/g,' ')
             .replace(/\t/g,' ').replace(/[^\w\s\.\-]/gi,' ')
             .replace(/\s+/g,' ').trim();

  let league = detectLeague(text);
  if(!league){document.getElementById("pick").innerHTML="Nu s-a detectat liga."; return;}
  let teams = leagues[league];
  let matches = [];
  let added = new Set();

  // cautam meciuri
  for(let i=0;i<text.length;i++){
    for(let t1 of teams){
      if(text.toLowerCase().includes(t1.toLowerCase())){
        for(let t2 of teams){
          if(t1!==t2 && text.toLowerCase().includes(t2.toLowerCase())){
            let key = t1 + "|" + t2;
            if(added.has(key)) continue;
            added.add(key);

            // Extract cote: toate numerele cu punct din text dupÄƒ echipe
            let regexOdds=/(\d+\.\d+)/g;
            let numbers = text.match(regexOdds);
            let odds=[1.5,3.0,2.5]; // fallback
            if(numbers && numbers.length>=3){
              odds=[parseFloat(numbers[0]),parseFloat(numbers[1]),parseFloat(numbers[2])];
            }

            // Extract xG: cauta pattern <num>xG
            let regexXG=/(\d*\.?\d+)xG/gi;
            let xgMatch=text.match(regexXG);
            let xgH=1.5, xgA=1.5;
            if(xgMatch && xgMatch.length>=1)xgH=parseFloat(xgMatch[0]);
            if(xgMatch && xgMatch.length>=2)xgA=parseFloat(xgMatch[1]);

            // Monte Carlo
            let sim=monteCarlo(xgH,xgA);
            let maxP=Math.max(sim.pH,sim.pX,sim.pA);
            let edge=0;
            if(maxP==sim.pH) edge=(sim.pH*odds[0]-1);
            else if(maxP==sim.pX) edge=(sim.pX*odds[1]-1);
            else edge=(sim.pA*odds[2]-1);

            if(edge>0){
              let pick=maxP==sim.pH?t1:maxP==sim.pX?"Egal":t2;
              matches.push({pick:pick, info:`Liga: ${league} | ${t1} vs ${t2} | Cote: ${odds[0]}/${odds[1]}/${odds[2]} | xG: ${xgH.toFixed(1)}-${xgA.toFixed(1)} | Edge: ${edge.toFixed(2)}`});
            }
          }
        }
      }
    }
  }

  if(matches.length==0){document.getElementById("pick").innerHTML="Nu sunt meciuri profitabile"; return;}

  // afisare pe rand
  let index=0;
  document.getElementById("pick").innerHTML=matches[index].pick;
  document.getElementById("badge").innerHTML=matches[index].info;

  setInterval(()=>{
    index=(index+1)%matches.length;
    document.getElementById("pick").innerHTML=matches[index].pick;
    document.getElementById("badge").innerHTML=matches[index].info;
  },3000);
}
</script>

</body>
</html>