<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BOMBO – Independent Offer Integrity Signals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0f1220;
  color: #fff;
  margin: 0;
  padding: 24px;
}
h1 { margin-bottom: 4px; }
.subtitle { color: #aaa; margin-bottom: 20px; }
.panel {
  background: #161a33;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 20px;
}
label {
  display: block;
  margin: 10px 0 6px;
  font-size: 14px;
  color: #ccc;
}
textarea, select, button {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
}
textarea { min-height: 90px; }
button {
  background: #4f7cff;
  color: white;
  font-weight: 600;
  cursor: pointer;
  margin-top: 14px;
}
.signalRow {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 22px;
  font-weight: 700;
}
.dot {
  width: 18px; height: 18px; border-radius: 50%;
  opacity: 0.2;
}
.dot.green { background:#5dff9b; }
.dot.orange { background:#ffd45d; }
.dot.red { background:#ff6b6b; }
.dot.active { opacity:1; }
.badge {
  display:inline-block;
  padding:4px 10px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  margin:4px 6px 0 0;
}
.badge.green{background:#1e6f4a}
.badge.orange{background:#6f5a1e}
.badge.red{background:#6f1e1e}
ul{padding-left:18px}
details{
  background:#12162b;
  border-radius:8px;
  padding:10px;
  margin-top:10px;
}
summary{cursor:pointer;font-weight:600;color:#9fb3ff}
footer{
  margin-top:30px;
  font-size:12px;
  color:#777;
  text-align:center;
}
code{color:#9fb3ff}
</style>
</head>

<body>

<h1>BOMBO</h1>
<div class="subtitle">
Independent Integrity Signal Engine – deterministic, auditable, fingerprinted
</div>

<div class="panel">
  <label>Offer text</label>
  <textarea id="offerText"
    placeholder="70% OFF – Only today! Best deal ever. No refunds."></textarea>

  <label>Affiliate metadata (optional)</label>
  <select id="affiliate">
    <option value="clean">No redirect masking</option>
    <option value="masked">Masked / chained redirect</option>
  </select>

  <button onclick="runCheck()">Run Integrity Check</button>
</div>

<div class="panel" id="result" style="display:none;">
  <div class="signalRow">
    <div class="dot green" id="dotGreen"></div>
    <div class="dot orange" id="dotOrange"></div>
    <div class="dot red" id="dotRed"></div>
    <span id="signalText"></span>
  </div>

  <h3>Detected Signals</h3>
  <div id="signals"></div>

  <h3>Explanation</h3>
  <ul id="explanations"></ul>

  <details>
    <summary>Offer Fingerprint</summary>
    <div><strong>BOMBO-OFFER-ID:</strong></div>
    <code id="fingerprint"></code>
  </details>

  <details>
    <summary>Audit Log (verifiable)</summary>
    <ul id="auditLog"></ul>
  </details>

  <details>
    <summary>Export – Legal / Compliance</summary>
    <pre id="exportBox"></pre>
  </details>

  <details>
    <summary>Open Rule Specification</summary>
<pre>
Deterministic signal engine
Fingerprinted offer identity

Fingerprint inputs:
- discount flag
- urgency flag
- refund limitation
- affiliate masking
- signal count
- text length bucket

Same structure = same fingerprint
</pre>
  </details>
</div>

<footer>
<strong>Disclaimer:</strong> Informational integrity signals only.<br>
<strong>Privacy:</strong> All processing local. No tracking. No storage.
</footer>

<script>
async function runCheck(){
  const textRaw = document.getElementById("offerText").value;
  const text = textRaw.toLowerCase();
  const affiliate = document.getElementById("affiliate").value;

  const signals=[], explanations=[], audit=[];
  let critical=false;

  function add(sig, exp, src, isCritical=false){
    signals.push(sig);
    explanations.push(exp);
    audit.push(`${sig} ← ${src}${isCritical?" [CRITICAL]":""}`);
    if(isCritical) critical=true;
  }

  // ---- SIGNAL EXTRACTION ----
  const hasDiscount = /\d+\s?%/.test(text);
  const hasUrgency = /only today|ends in|last chance|countdown|hurry/.test(text);
  const hasRefundLimit = /no refunds|no return/.test(text);
  const hasExaggeration = /best ever|guaranteed|insane deal/.test(text);

  if (hasDiscount)
    add("Discount claim","Percentage discount detected.","text");

  if (hasUrgency)
    add("Artificial urgency","Time pressure language.","text",true);

  if (hasRefundLimit)
    add("Refund limitation","Refunds restricted.","text",true);

  if (hasExaggeration)
    add("Emotional exaggeration","Subjective persuasion.","text");

  if (affiliate==="masked")
    add("Affiliate redirect masking","Destination obscured.","metadata");

  // ---- CLASSIFICATION ----
  let level,color;
  if (critical || signals.length>=3){
    level="HIGH RISK SIGNAL"; color="red";
  } else if (signals.length>0){
    level="ATTENTION SIGNAL"; color="orange";
  } else {
    level="NO RISK SIGNALS"; color="green";
  }

  // ---- FINGERPRINT ----
  const lengthBucket =
    textRaw.length < 80 ? "S" :
    textRaw.length < 200 ? "M" : "L";

  const fingerprintSource = [
    hasDiscount ? 1:0,
    hasUrgency ? 1:0,
    hasRefundLimit ? 1:0,
    affiliate==="masked" ? 1:0,
    signals.length,
    lengthBucket
  ].join("|");

  const hash = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(fingerprintSource)
  );
  const fingerprint = [...new Uint8Array(hash)]
    .map(b=>b.toString(16).padStart(2,"0"))
    .join("");

  // ---- RENDER ----
  document.getElementById("result").style.display="block";
  setDots(color);
  document.getElementById("signalText").textContent=level;
  document.getElementById("fingerprint").textContent=fingerprint;

  render("signals",signals,color,true);
  render("explanations",explanations,false);
  render("auditLog",audit,false);

  document.getElementById("exportBox").textContent=
`Integrity Signal: ${level}
BOMBO-OFFER-ID: ${fingerprint}

Detected signals:
${audit.join("\n")}

Method:
Deterministic extraction + structural fingerprint.
Same structure = same ID.`;
}

function setDots(c){
  ["Green","Orange","Red"].forEach(x=>{
    document.getElementById("dot"+x).classList.remove("active");
  });
  document.getElementById("dot"+c.charAt(0).toUpperCase()+c.slice(1)).classList.add("active");
}

function render(id,list,color,badge){
  const el=document.getElementById(id);
  el.innerHTML="";
  list.forEach(i=>{
    if(badge){
      el.innerHTML+=`<span class="badge ${color}">${i}</span>`;
    } else {
      const li=document.createElement("li");
      li.textContent=i;
      el.appendChild(li);
    }
  });
}
</script>

</body>
</html>