<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”¥ Smart Bet Detector ULTRA PRO++ LIVE ðŸ§ âš½</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body{background:#0f172a;color:#e2e8f0;font-family:system-ui;text-align:center;padding:20px;}
h1{color:#22c55e;font-size:22px;}
button{padding:12px 20px;margin:10px;border:none;border-radius:8px;background:#22c55e;color:#000;font-weight:bold;cursor:pointer;}
#preview,#output{margin-top:20px;text-align:left;}
.match{margin:10px 0;padding:12px;background:#111827;border-radius:8px;transition:transform 0.2s;}
.match:hover{transform:scale(1.02);}
.high{border-left:5px solid #22c55e;}
.medium{border-left:5px solid #facc15;}
.low{border-left:5px solid #ef4444;}
canvas{max-width:100%;margin-top:20px;border:1px solid #444;border-radius:8px;}
</style>
</head>
<body>

<h1>ðŸ”¥ Smart Bet Detector ULTRA PRO++ LIVE ðŸ§ âš½</h1>
<input type="file" id="imageInput"><br>
<button onclick="runOCR()">ScaneazÄƒ</button>
<h3>Preview OCR</h3>
<canvas id="canvas"></canvas>
<h3>Meciuri Detectate</h3>
<div id="output"></div>

<script>

// ------------------ CLEAN OCR ------------------
function cleanOCR(text){
    return text.replace(/[\*|@#\$%Â®<>\-]/g,'.')
               .replace(/\s{2,}/g,' ')
               .split("\n")
               .map(l=>l.trim())
               .filter(l=>l.length>1);
}

// ------------------ PARSER MECIURI ------------------
function parseMatches(lines){
    let matches=[], buffer=[];
    for(let line of lines){
        let odds = line.match(/(\d+\.\d+)/g);
        if(odds && odds.length>=3){
            let odd1=parseFloat(odds[0]), oddX=parseFloat(odds[1]), odd2=parseFloat(odds[2]);
            let home="", away="";
            for(let i=buffer.length-1;i>=0;i--){
                if(!buffer[i].match(/\d/)){
                    if(!away) away=buffer[i]; else { home=buffer[i]; break; }
                }
            }
            if(home && away && home!==away){
                if(!matches.some(m=>m.home===home && m.away===away)){
                    matches.push({home,away,odd1,oddX,odd2});
                }
            }
        } else {
            buffer.push(line);
        }
    }
    return matches;
}

// ------------------ FETCH LIVE RESULTS (API REAL) ------------------
async function fetchLiveForm(team){
    try {
        const API_KEY = "CHEIA_TA_API"; // <-- Ã®nlocuieÈ™te cu cheia ta realÄƒ
        let res = await fetch(`https://api.exemplu.com/results?team=${encodeURIComponent(team)}&last=5&apikey=${API_KEY}`);
        let data = await res.json();
        let score=0;
        data.results.forEach(r=>{
            if(r.result==="win") score+=1;
            else if(r.result==="draw") score+=0.5;
        });
        return score/5; // scor Ã®ntre 0 È™i 1
    } catch(e){ console.error("Eroare API:", e); return 0.5; }
}

// ------------------ CALCUL PROBABILITATE + VALUE ------------------
function calculate(match){
    let p1=1/match.odd1, pX=1/match.oddX, p2=1/match.odd2;
    let total=p1+pX+p2; p1/=total; pX/=total; p2/=total;
    let maxProb=Math.max(p1,pX,p2);
    let pick=maxProb===p1?match.home:maxProb===p2?match.away:"Egal";
    let percent=(maxProb*100).toFixed(2);
    let valueIndex=(Math.abs((p1*match.odd1 + p2*match.odd2)/2 - 1) * 1.2).toFixed(2);
    return {pick,percent,maxProb,valueIndex};
}

// ------------------ DISPLAY ------------------
function display(matches){
    let container=document.getElementById("output");
    container.innerHTML="";
    if(matches.length===0){ container.innerHTML="Nu s-au detectat meciuri valide."; return; }
    matches.forEach(m=>{
        let calc=calculate(m);
        let level="low";
        if(calc.maxProb>0.55) level="high";
        else if(calc.maxProb>0.40) level="medium";
        container.innerHTML+=`
        <div class="match ${level}">
        <b>${m.home} vs ${m.away}</b><br>
        Cote: ${m.odd1} / ${m.oddX} / ${m.odd2}<br>
        ðŸ”¥ Recomandare Smart: <b>${calc.pick}</b><br>
        Scor Ã®ncredere: ${calc.percent}%<br>
        Value index: ${calc.valueIndex}
        </div>`;
    });
}

// ------------------ RUN OCR ------------------
async function runOCR(){
    let file=document.getElementById("imageInput").files[0];
    if(!file){ alert("SelecteazÄƒ o pozÄƒ"); return; }
    let canvas=document.getElementById("canvas"), ctx=canvas.getContext("2d");
    let img=new Image();
    img.onload = async function(){
        canvas.width=img.width; canvas.height=img.height;
        ctx.drawImage(img,0,0);
        let { data:{ text, words } } = await Tesseract.recognize(file,'eng',{logger:m=>console.log(m)});
        let cleaned=cleanOCR(text);
        let matches=parseMatches(cleaned);

        // ajustare cote cu scor live
        for(let m of matches){
            let homeScore = await fetchLiveForm(m.home);
            let awayScore = await fetchLiveForm(m.away);
            m.odd1 *= 1 - homeScore*0.25;
            m.odd2 *= 1 - awayScore*0.25;
            m.oddX *= 1 - ((homeScore+awayScore)/2)*0.15;
        }

        display(matches);

        // highlight cote pe canvas
        ctx.strokeStyle="red"; ctx.lineWidth=2; ctx.font="18px Arial"; ctx.fillStyle="yellow";
        words.forEach(w=>{
            if(w.text.match(/\d+\.\d+/)){
                ctx.strokeRect(w.bbox.x0,w.bbox.y0,w.bbox.x1-w.bbox.x0,w.bbox.y1-w.bbox.y0);
                ctx.fillText(w.text,w.bbox.x0,w.bbox.y0-5);
            }
        });
    };
    img.src=URL.createObjectURL(file);
}
</script>

</body>
</html>