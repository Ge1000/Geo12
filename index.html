<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Geo Quick Single Pick</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body {
  font-family: system-ui;
  background: #0f1220;
  color: #00ff9d;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
  text-align: center;
}
input, button {
  padding: 12px;
  margin: 10px;
  font-size: 18px;
}
#pick {
  font-size: 48px;
  font-weight: bold;
  margin-top: 50px;
}
</style>
</head>
<body>

<h2>ðŸ“¸ Geo Quick Single Pick</h2>
<input type="file" id="imgInput" accept="image/*">
<button onclick="runOCR()">AratÄƒ cÃ¢È™tigÄƒtorul</button>

<div id="pick"></div>

<script>
function poissonRandom(lambda){
  let L=Math.exp(-lambda),p=1,k=0;
  while(p>L){k++; p*=Math.random();}
  return k-1;
}

function monteCarlo(xgH,xgA,sims=100000){
  let cH=0, cX=0, cA=0;
  for(let i=0;i<sims;i++){
    let h=poissonRandom(xgH), a=poissonRandom(xgA);
    if(h>a)cH++; else if(h==a)cX++; else cA++;
  }
  return {pH:cH/sims, pX:cX/sims, pA:cA/sims};
}

function runOCR(){
  let file=document.getElementById("imgInput").files[0];
  if(!file){alert("Alege poza"); return;}
  document.getElementById("pick").innerHTML = "Se proceseazÄƒ OCR...";
  Tesseract.recognize(file,'eng',{logger:m=>console.log(m)})
    .then(({data:{text}})=>{processText(text);});
}

function processText(text){
  text=text.replace(/\r/g,'\n').replace(/\t/g,' ').replace(/\s+/g,' ').trim();
  let lines=text.split("\n").map(l=>l.trim()).filter(l=>l.length>0);
  if(lines.length==0){document.getElementById("pick").innerHTML="Nu s-au gÄƒsit meciuri valide"; return;}

  // LuÄƒm doar primul meci pentru single pick
  let l = lines[0];

  // Extragem cote
  let numbers=l.match(/[\d]+\.[\d]+/g);
  if(!numbers || numbers.length<2){document.getElementById("pick").innerHTML="Nu s-au gÄƒsit meciuri valide"; return;}

  let parts=l.split(numbers[0]);
  let teamA=parts[0].trim();
  let odd1=parseFloat(numbers[0]);
  let oddX=parseFloat(numbers[1]);
  let odd2=numbers.length>=3?parseFloat(numbers[2]):odd1;

  let lastIndex=l.lastIndexOf(numbers[numbers.length>=3?2:1]);
  let teamB=l.substring(lastIndex+numbers[numbers.length>=3?2:1].length).replace(/xG/gi,'').trim();

  // xG fallback
  let xgMatch=l.match(/(\d*\.?\d+)xG/gi);
  let xgH=1.5, xgA=1.5;
  if(xgMatch && xgMatch.length>=1)xgH=parseFloat(xgMatch[0]);
  if(xgMatch && xgMatch.length>=2)xgA=parseFloat(xgMatch[1]);

  // Monte Carlo
  let sim=monteCarlo(xgH,xgA);

  // Pick cÃ¢È™tigÄƒtor
  let maxP=Math.max(sim.pH,sim.pX,sim.pA);
  let pick="";
  if(maxP==sim.pH) pick=teamA;
  else if(maxP==sim.pX) pick="Egal";
  else pick=teamB;

  document.getElementById("pick").innerHTML = pick;
}
</script>

</body>
</html>