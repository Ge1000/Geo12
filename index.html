<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”¥ Smart Bet Detector PRO+</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<style>
body{
    font-family: system-ui;
    background:#0f1220;
    color:#fff;
    text-align:center;
    padding:20px;
}
button{
    padding:12px 25px;
    font-size:16px;
    border:none;
    border-radius:8px;
    background:#ff9800;
    color:#000;
    cursor:pointer;
    margin-top:10px;
}
#results{
    margin-top:20px;
    text-align:left;
    max-width:700px;
    margin-left:auto;
    margin-right:auto;
}
.match{
    background:#1c2035;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
}
.confidence{
    color:#00e676;
}
</style>
</head>
<body>

<h1>ðŸ”¥ Smart Bet Detector PRO+</h1>

<input type="file" id="imageInput" accept="image/*">
<br>
<button onclick="scanImage()">ScaneazÄƒ</button>

<div id="results"></div>

<script>

async function scanImage(){
    const file = document.getElementById('imageInput').files[0];
    if(!file) return alert("SelecteazÄƒ o imagine");

    document.getElementById("results").innerHTML="ðŸ” Analizez...";

    const { data: { text } } = await Tesseract.recognize(
        file,
        'eng',
        { logger: m => console.log(m) }
    );

    console.log("OCR RAW:", text);

    const matches = parseMatches(text);

    displayResults(matches);
}

function cleanText(text){
    return text
        .replace(/,/g,".")
        .replace(/[^\w.\s]/g," ")
        .replace(/\s+/g," ")
        .trim();
}

function normalizeOdd(val){

    if(!val) return null;

    if(/^\d+\.\d+$/.test(val))
        return parseFloat(val);

    if(/^\d{3}$/.test(val))
        return parseFloat(val[0]+"."+val.slice(1));

    if(/^\d{4}$/.test(val))
        return parseFloat(val.slice(0,2)+"."+val.slice(2));

    return null;
}

function parseMatches(rawText){

    let text = cleanText(rawText);
    let tokens = text.split(" ");

    let matches=[];

    for(let i=0;i<tokens.length;i++){

        let o1 = normalizeOdd(tokens[i]);
        let oX = normalizeOdd(tokens[i+1]);
        let o2 = normalizeOdd(tokens[i+2]);

        if(o1 && oX && o2 && o1>1 && oX>1 && o2>1){

            let teams=[];

            for(let j=i-1;j>=0;j--){
                if(
                    !/^\d/.test(tokens[j]) &&
                    tokens[j].toLowerCase()!=="egal" &&
                    tokens[j].toLowerCase()!=="meci" &&
                    tokens[j].length>2
                ){
                    teams.unshift(tokens[j]);
                }
                if(teams.length===2) break;
            }

            if(teams.length===2){

                let confidence = calculateConfidence(o1,oX,o2);

                matches.push({
                    home:teams[0],
                    away:teams[1],
                    odds:[o1,oX,o2],
                    confidence:confidence
                });
            }
        }
    }

    return matches;
}

function calculateConfidence(o1,oX,o2){

    let inv = (1/o1 + 1/oX + 1/o2);
    let margin = inv - 1;

    let score = (1 - margin) * 100;

    if(score>100) score=100;
    if(score<0) score=0;

    return score.toFixed(2);
}

function displayResults(matches){

    const container = document.getElementById("results");

    if(matches.length===0){
        container.innerHTML="âŒ Nu s-au detectat meciuri valide.";
        return;
    }

    container.innerHTML="<h2>Meciuri Detectate</h2>";

    matches.forEach(m=>{
        container.innerHTML += `
        <div class="match">
            <strong>${m.home} vs ${m.away}</strong><br>
            Cote: ${m.odds[0]} / ${m.odds[1]} / ${m.odds[2]}<br>
            ðŸ”¥ Recomandare Smart: ${m.home}<br>
            <span class="confidence">Scor Ã®ncredere: ${m.confidence}%</span>
        </div>
        `;
    });
}

</script>

</body>
</html>