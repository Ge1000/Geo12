<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Geo Nuclear Quick Pick 4.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body {
  font-family: system-ui;
  background: #0f1220;
  color: #00ff9d;
  margin: 0;
  padding: 20px;
}
h2 {text-align:center;}
#matches {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 20px;
}
.match {
  background: #111a33cc;
  padding: 15px;
  border-radius: 10px;
  font-size: 16px;
  color: #ffffff;
}
.match h3 {
  font-size: 24px;
  margin: 0 0 5px 0;
  color: #00ff9d;
}
.match p {
  margin: 2px 0;
  font-size: 14px;
  color: #ffffffaa;
}
input, button {
  padding: 10px;
  margin: 5px;
  font-size: 16px;
}
</style>
</head>
<body>

<h2>ðŸ’¥ Geo Nuclear Quick Pick 4.2 ðŸ’¥</h2>
<input type="file" id="imgInput" accept="image/*">
<button onclick="runOCR()">RuleazÄƒ analizÄƒ</button>

<div id="matches"></div>

<script>
// Monte Carlo
function poissonRandom(lambda){let L=Math.exp(-lambda),p=1,k=0;while(p>L){k++;p*=Math.random();}return k-1;}
function monteCarlo(xgH,xgA,sims=100000){
  let cH=0, cX=0, cA=0;
  for(let i=0;i<sims;i++){
    let h=poissonRandom(xgH), a=poissonRandom(xgA);
    if(h>a)cH++; else if(h==a)cX++; else cA++;
  }
  return {pH:cH/sims, pX:cX/sims, pA:cA/sims};
}

// OCR
function runOCR(){
  let file=document.getElementById("imgInput").files[0];
  if(!file){alert("Alege poza"); return;}
  document.getElementById("matches").innerHTML = "Se proceseazÄƒ OCR...";
  Tesseract.recognize(file,'eng',{logger:m=>console.log(m)})
    .then(({data:{text}})=>{processText(text);});
}

// Parse avansat: detecteazÄƒ exact meciurile din text
function processText(text){
  text = text.replace(/\r/g,' ').replace(/\n/g,' ')
             .replace(/\t/g,' ').replace(/[^\w\s\.\-xG]/gi,' ')
             .replace(/\s+/g,' ').trim();

  const matchRegex = /([A-Za-z\s]+)\s*-\s*([A-Za-z\s]+).*?([\d.]+)\s*([\d.]+)\s*([\d.]+)(.*?(\d*\.?\d+)xG.*?(\d*\.?\d+)xG)?/gi;
  let matchesDiv = document.getElementById("matches");
  matchesDiv.innerHTML = "";
  let matchesFound = [];
  let m;

  while((m = matchRegex.exec(text)) !== null){
    let team1 = m[1].trim();
    let team2 = m[2].trim();
    let odd1 = parseFloat(m[3]);
    let oddX = parseFloat(m[4]);
    let odd2 = parseFloat(m[5]);
    let xgH = m[7]?parseFloat(m[7]):1.5;
    let xgA = m[8]?parseFloat(m[8]):1.5;

    // Monte Carlo
    let sim = monteCarlo(xgH,xgA);
    let maxP = Math.max(sim.pH, sim.pX, sim.pA);
    let edge = 0;
    if(maxP==sim.pH) edge = sim.pH*odd1-1;
    else if(maxP==sim.pX) edge = sim.pX*oddX-1;
    else edge = sim.pA*odd2-1;

    if(edge>0){
      let pick = maxP==sim.pH?team1:maxP==sim.pX?"Egal":team2;
      let key = team1+"|"+team2;
      if(matchesFound.includes(key)) continue;
      matchesFound.push(key);

      // afiÈ™are
      let div = document.createElement("div");
      div.className = "match";
      div.innerHTML = `<h3>${pick}</h3>
                       <p>${team1} vs ${team2}</p>
                       <p>Cote: ${odd1}/${oddX}/${odd2}</p>
                       <p>xG: ${xgH}-${xgA}</p>
                       <p>Edge: ${edge.toFixed(2)}</p>`;
      matchesDiv.appendChild(div);
    }
  }

  if(matchesDiv.children.length==0){
    matchesDiv.innerHTML = "Nu sunt meciuri profitabile";
  }
}
</script>

</body>
</html>