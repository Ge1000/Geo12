<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Geo OCR + xG Analyzer Simplu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
body{font-family:system-ui;background:#0f1220;color:white;padding:20px}
input,button{padding:8px;margin:5px}
.box{background:#1a1f38;padding:15px;margin-top:20px;border-radius:10px}
.good{color:#00ff9d}
.bad{color:#ff4d4d}
h3{margin-top:15px}
</style>
</head>
<body>

<h2>ðŸ“¸ Geo OCR + xG Analyzer Simplu</h2>

<p>ÃŽncarcÄƒ poza cu meciuri + cote + xG + rezultat (1/X/2):</p>
<input type="file" id="imgInput" accept="image/*">
<button onclick="runOCR()">RuleazÄƒ AnalizÄƒ</button>

<div class="box" id="result">Rezultatele vor apÄƒrea aici...</div>

<script>
// --- FuncÈ›ii matematice ---
function poissonRandom(lambda){let L=Math.exp(-lambda),p=1,k=0;while(p>L){k++;p*=Math.random();}return k-1;}
function monteCarlo(xgH,xgA,sims=100000){let c1=0,cX=0,c2=0;for(let i=0;i<sims;i++){let h=poissonRandom(xgH),a=poissonRandom(xgA);if(h>a)c1++;else if(h==a)cX++;else c2++;}return [c1/sims,cX/sims,c2/sims];}
function kelly(prob,odd){let b=odd-1;let edge=(prob*(b+1)-1)/b;return edge;}

// --- OCR + parse + analizÄƒ ---
function runOCR(){
  let file=document.getElementById("imgInput").files[0];
  if(!file){alert("Alege o poza"); return;}
  result.innerHTML="Se proceseazÄƒ OCR...â³";

  Tesseract.recognize(file,'eng',{logger:m=>console.log(m)}).then(({data:{text}})=>{
    processText(text);
  });
}

function processText(text){
  let lines=text.split("\n").map(l=>l.trim()).filter(l=>l.length>0);
  let output="";

  for(let l of lines){
    // Caut pattern: TeamA xG odd1 X oddX TeamB xG odd2 rezultat
    // Ex: TeamA 1.6xG 2.10 X 3.40 TeamB 1.4xG 3.50 1
    let m=l.match(/(\w+)\s+([\d.]+)xG\s+([\d.]+)\s+X\s+([\d.]+)\s+(\w+)\s+([\d.]+)xG\s+([\d.]+)\s+([1X2])/i);
    if(!m) continue;
    let teamA=m[1], xgH=parseFloat(m[2]), odd1=parseFloat(m[3]),
        oddX=parseFloat(m[4]), teamB=m[5], xgA=parseFloat(m[6]),
        odd2=parseFloat(m[7]), resultReal=m[8].toUpperCase();

    let probs=monteCarlo(xgH,xgA);
    let edge=[probs[0]-1/odd1,probs[1]-1/oddX,probs[2]-1/odd2];
    let bestIndex=edge.indexOf(Math.max(...edge));
    let pick=["1","X","2"][bestIndex];

    let cls=edge[bestIndex]>0.04?"good":"bad"; // edge >4% = value bet
    output+=`<p class="${cls}">
      ${teamA} vs ${teamB} | Pick: ${pick} | Prob: ${(probs[bestIndex]*100).toFixed(2)}% | Edge: ${(edge[bestIndex]*100).toFixed(2)}% | Rezultat real: ${resultReal}
    </p>`;
  }

  result.innerHTML=output||"Nu s-au gÄƒsit meciuri valide Ã®n pozÄƒ.";
}
</script>

</body>
</html>